"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var HVAutocomplete=function(){function t(e){_classCallCheck(this,t),this.config=e,this.input=e.input,this.data=e.data,this.divResult,this.divWrap,this.checkOnType(this.config)}return _createClass(t,[{key:"checkOnType",value:function(t){var e="HV-Autcomplete crash :(\n\n";for(var i in t)switch(i){case"data":var s=void 0;if(Array.isArray(t[i])&&(s=!0),"object"===_typeof(t[i])&&(s=!0),"function"==typeof t[i]&&(s=!0),!s)throw new Error(e+' Option "data" must be an Object or Array!\n Please, check on correctly data types.');break;case"input":if("INPUT"!==t.input.tagName)throw new Error(e+' Option "input" must be DOM Element <input />!\n Please, check on correctly data types.');break;case"maxOptions":if("number"!=typeof t.maxOptions)throw new Error(e+' Option "maxOptions" must be a Number!\n Please, check on correctly data types.');break;case"horizontal":if("boolean"!=typeof t.horizontal)throw new Error(e+' Option "horizontal" must be a Boolean!\n Please, check on correctly data types.');break;case"globalSearch":if("boolean"!=typeof t.globalSearch)throw new Error(e+' Option "globalSearch" must be a Boolean!\n Please, check on correctly data types.');break;case"resultClass":if("string"!=typeof t.resultClass)throw new Error(e+' Option "resultClass" must be a String!\n Please, check on correctly data types.');break;case"resultStyles":if("object"!==_typeof(t.resultStyles))throw new Error(e+' Option "resultStyles" must be a Object!\n Please, check on correctly data types.');break;case"onOptionClick":if("function"!=typeof t.onOptionClick)throw new Error(e+' Option "onOptionClick" must be a Function!\n Please, check on correctly data types.')}return this.initialize(t)}},{key:"initialize",value:function(t){"error"!==status&&(this.defaultConfig={resultClass:t.resultClass?t.resultClass:"hv-result",inputClass:t.inputClass?t.inputClass:"hv-shell",maxOptions:void 0===t.maxOptions?5:t.maxOptions,onOptionClick:t.onOptionClick&&t.onOptionClick,prefix:this.input.getAttribute("id")||this.input.getAttribute("class")},this.build(),new HVAutocompleteEvents(this.input,this.divResult,this.divWrap,this.data,this.config,this.defaultConfig))}},{key:"build",value:function(){this.divResult=document.createElement("div"),this.divResult.setAttribute("id","hv-result-"+this.defaultConfig.prefix),this.divResult.setAttribute("class",this.defaultConfig.resultClass),this.createWrap(),this.configureStyles()}},{key:"createWrap",value:function(){var t=document.createElement("div"),e=this.input.parentNode;t.style.position="relative",e.replaceChild(t,this.input),t.appendChild(this.input),t.appendChild(this.divResult),this.divWrap=t}},{key:"configureStyles",value:function(){var t=this.config,e=t.resultClass,i=t.resultStyles,s=(t.inputStyles,t.horizontal),n=t.data,a={position:"absolute",top:this.input.clientHeight,width:this.input.clientWidth+"px",left:"0px",display:"none",backgroundColor:"#fff",boxSizing:"border-box"},l={};if(e){var r={position:"absolute",top:this.input.clientHeight,left:"0px",display:"none"};this.setStyles(this.divResult,r)}else this.setStyles(this.divResult,a);s&&(l.display="flex"),Array.isArray(n)&&(l.padding=0),i&&this.setStyles(this.divResult,i),this.setStyles(this.input,{boxSizing:"border-box"}),this.divResult.style.display="none"}},{key:"setStyles",value:function(t,e){for(var i in e)t.style[i]=e[i]}}]),t}(),HVAutocompleteEvents=function(){function t(e,i,s,n,a,l){var r=this;_classCallCheck(this,t),this.blockResult=[],this.input=e,this.divResult=i,this.divWrap=s,this.config=a,this.defaultConfig=l,this.result,e.addEventListener("mousedown",function(){r.lifeCicle(n)}),e.addEventListener("keyup",function(){"function"==typeof n?r.asyncRequest(n(r.input)):r.lifeCicle(n)}),this.clickOutBlock(i)}return _createClass(t,[{key:"asyncRequest",value:function(t){var e=t.url,i=t.method,s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=s.responseText;t.success&&t.success(e);var i=void 0;Array.isArray(e)&&(i=!0),"object"===(void 0===e?"undefined":_typeof(e))&&(i=!0),i?200!==this.status&&this.lifeCicle(e):console.error('HV-Autcomplete crash :(\n\n Option "data" must be a Object or Array!\n Please, check your type data.')}},s.open(i,e,!0),s.send()}},{key:"clickOutBlock",value:function(t){var e=this;this.input.addEventListener("click",function(t){e.clickOnWrap(t)}),t.addEventListener("click",function(t){e.clickOnWrap(t)}),document.addEventListener("click",function(){t&&(t.style.display="none")})}},{key:"clickOnWrap",value:function(t){t?t.stopPropagation():window.event.cancelBubble=!0,this.divResult.style.display=this.result&&this.result.length>0?this.checkHorizontalConfig():"none"}},{key:"lifeCicle",value:function(t){this.resetChildNodes();var e=Array.isArray(t);this.input.value||this.config.globalSearch?(this.result=e?this.createDefaultResult(t,"no-category"):this.createWithCategoryResult(t),this.renderResult(this.result)):this.divResult.style.display="none"}},{key:"renderResult",value:function(t){if(0!==t.length){for(var e=0;e<t.length;e++)this.divResult.appendChild(t[e]);this.divResult.style.display=this.checkHorizontalConfig()}else this.divResult.style.display="none"}},{key:"checkHorizontalConfig",value:function(){return this.config.horizontal?"flex":"block"}},{key:"resetChildNodes",value:function(){for(this.result=null;this.divResult.firstChild;)this.divResult.removeChild(this.divResult.firstChild)}},{key:"createWithCategoryResult",value:function(t){for(var e=[],i=Object.keys(t),s=0;s<i.length;s++){if(0!==t[i[s]].length){var n=this.buildListWithCategory(t[i[s]].data,t[i[s]].title);n&&e.push(n)}}return e}},{key:"createDefaultResult",value:function(t,e,i){var s=this,n=this.defaultConfig,a=n.maxOptions,l=n.onOptionClick,r=1,o=[],u=function(n){if(a&&r>a)return"break";var u=s.config.globalSearch?s.globalSearch(t[n].name):s.defaultSearch(t[n].name),c=document.createElement("a");c.setAttribute("class",s.setUnicClass("element-"+e)),c.style.display="block",t[n].url&&c.setAttribute("href",t[n].url),c.innerHTML=u,l&&(c.onclick=function(e){var s=t[n].name,a=t[n].url;return l(e,s,a,i)}),a&&u&&r<=a?(o.push(c),r++):!a&&u&&o.push(c)};for(var c in t){if("break"===u(c))break}return o}},{key:"buildListWithCategory",value:function(t,e){var i=this.createDefaultResult(t,"with-category",e),s=document.createElement("h3");s.setAttribute("class",this.setUnicClass("title-category")),s.innerHTML=e,i.unshift(s);var n=document.createElement("div");n.setAttribute("class",this.setUnicClass("block-category"));var a=this.config.maxOptions?this.config.maxOptions:i.length;if(a<3?a=3:a++,i.length>1)for(var l=0;l<a;l++)i[l]&&n.appendChild(i[l]);else{var r=document.createElement("p");if(r.setAttribute("class",this.setUnicClass("no-result")),r.innerHTML="No result",this.config.horizontal){i.push(r);for(var o=0;o<i.length;o++)n.appendChild(i[o])}}if(n.childElementCount>0)return n}},{key:"setUnicClass",value:function(t){return this.config.resultClass?this.config.resultClass+"-"+t:"hv-"+t}},{key:"defaultSearch",value:function(t){var e=this.input.value,i=new RegExp("^"+e,"ig"),s=t.replace(i,"<b>$&</b>");if(s!==t)return s}},{key:"globalSearch",value:function(t){for(var e=this.input.value.split(" "),i=t.split(" "),s=[],n=!1,a=0;a<i.length;a++){for(var l=!0,r=0;r<e.length;r++)if(""!==e[r]){var o=new RegExp("\\b"+e[r],"i");if(-1!==i[a].search(o)){var u=i[a].replace(o,"<b>$&</b>");s.push(u),l=!1,n=!0;break}}l&&s.push(i[a])}if(n)return s.join(" ")}}]),t}();